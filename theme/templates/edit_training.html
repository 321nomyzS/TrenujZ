{% extends 'base.html' %}
{% load static %}

{% block extra_head %}
    <script>
        function warmupSeriesUpdate(index){
            const input = document.getElementsByName(`warmup-series-${index}`)
            let value = input[0].value
            for (let i = 1; i < 4; i++) {
                const warmupInput = document.getElementsByName(`warmup-series-${i}-rep-${index}`)[0]
                if (i <= value){
                    warmupInput.disabled = false;
                } else {
                    warmupInput.disabled = true;
                    warmupInput.value = '';
                }
            }
        }

        function mainSeriesUpdate(index){
            const input = document.getElementsByName(`main-series-${index}`)
            let value = input[0].value
            for (let i = 1; i < 5; i++) {
                const warmupInput = document.getElementsByName(`main-series-${i}-rep-${index}`)[0]
                if (i <= value){
                    warmupInput.disabled = false;
                } else {
                    warmupInput.disabled = true;
                    warmupInput.value = '';
                }
            }
        }

        function updateFieldNames() {
            const rows = document.querySelectorAll('tbody tr');
            rows.forEach((row, index) => {
                // Get all input elements in the row
                const inputs = row.querySelectorAll('input');
                const selects = row.querySelectorAll('select');
                const textareas = row.querySelectorAll('textarea');
                const hash_id = row.querySelectorAll('.exercise-hash-id');

                hash_id[0].innerHTML = `Ćwiczenie #${index + 1}`;
                selects[0].name = `exercise-id-${index + 1}`;
                selects[1].name = `alter-exercise-id-${index + 1}`;
                inputs[0].name = `tempo-${index + 1}`;
                inputs[1].name = `rest-min-${index + 1}`;
                inputs[2].name = `rest-sec-${index + 1}`;
                inputs[3].name = `warmup-series-${index + 1}`;
                inputs[3].oninput = function() {warmupSeriesUpdate(index + 1);}
                inputs[4].name = `main-series-${index + 1}`;
                inputs[4].oninput = function() {mainSeriesUpdate(index + 1);}
                inputs[5].name = `main-series-reps-${index + 1}`;
                inputs[6].name = `warmup-series-1-rep-${index + 1}`;
                inputs[7].name = `warmup-series-2-rep-${index + 1}`;
                inputs[8].name = `warmup-series-3-rep-${index + 1}`;
                inputs[9].name = `main-series-1-rep-${index + 1}`;
                inputs[10].name = `main-series-2-rep-${index + 1}`;
                inputs[11].name = `main-series-3-rep-${index + 1}`;
                inputs[12].name = `main-series-4-rep-${index + 1}`;
                textareas[0].name = `comment-${index + 1}`;
            });
        }
        function updateRowNumbers() {
            const rows = document.querySelectorAll('tbody tr');
            rows.forEach((row, index) => {
                row.querySelector('.exercise-hash-id').textContent = `Ćwiczenie #${index + 1}`;
            });
            document.getElementById('rowCount').value = document.querySelectorAll('tbody tr').length;
        }
        function initializeTable() {
            const tableBody = document.getElementById('exercise-list')
            tableBody.innerHTML = '';

            {% for workout_exercise in workout_exercises %}
                const newRow{{ forloop.counter }} = document.createElement('tr');
                newRow{{ forloop.counter }}.innerHTML = `
                                <div class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03] flex flex-col mb-4">
                                    <div class="px-5 py-4 sm:px-6 sm:py-5">
                                        <h3 class="exercise-hash-id text-base font-medium text-gray-800 dark:text-white/90">Ćwiczenie  #{{ forloop.counter }}</h3>
                                    </div>

                                    <!-- Główna siatka inputów -->
                                    <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6 p-6">

                                        <!-- Ćwiczenie -->
                                        <div>
                                            <label for="exercise-id" class="block mb-2 text-sm font-medium text-gray-900">Ćwiczenie</label>
                                            <select class="w-full bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 transition duration-300 ease-in-out focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm focus:shadow">
                                                {% for exercise in exercises %}
                                                    <option {% if exercise == workout_exercise.exercise %} selected {% endif %} value="{{ exercise.id }}">{{ exercise.id }} {{ exercise.title }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>

                                        <!-- Tempo -->
                                        <div>
                                            <label for="tempo" class="block mb-2 text-sm font-medium text-gray-900">Tempo</label>
                                            <input value="{{ workout_exercise.tempo }}"  type="text" class="w-full bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 transition duration-300 ease-in-out focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm focus:shadow">
                                        </div>

                                        <!-- Odpoczynek -->
                                        <div class="flex flex-col">
                                            <label for="rest" class="block mb-2 text-sm font-medium text-gray-900">Odpoczynek</label>
                                            <div class="flex gap-4">
                                                <input value="{{ workout_exercise.rest_min }}" type="number" class="w-16 bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm">
                                                <span class="flex items-center">:</span>
                                                <input value="{{ workout_exercise.rest_sec }}" type="number" class="w-16 bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm">
                                            </div>
                                        </div>

                                        <!-- Seria rozgrzewkowa -->
                                        <div>
                                            <label for="warmup-series" class="block mb-2 text-sm font-medium text-gray-900">Seria rozgrzewkowa</label>
                                            <input value="{{ workout_exercise.warmup_series }}" type="number" min="0" max="3" class="w-full bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm">
                                        </div>

                                        <!-- Seria główna -->
                                        <div>
                                            <label for="main-series" class="block mb-2 text-sm font-medium text-gray-900">Seria główna</label>
                                            <input value="{{ workout_exercise.main_series }}" type="number" min="0" max="4" class="w-full bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm">
                                        </div>

                                        <!-- Powtórzenia w serii głównej -->
                                        <div>
                                            <label for="main-series-reps" class="block mb-2 text-sm font-medium text-gray-900">Powtórzenia w serii głównej</label>
                                            <input value="{{ workout_exercise.main_series_reps }}" type="text" class="w-full bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm">
                                        </div>

                                        <!-- Seria rozgrzewkowa 1, 2, 3 -->
                                        <div>
                                            <label for="warmup-series-1-rep" class="block mb-2 text-sm font-medium text-gray-900">Seria rozgrzewkowa 1</label>
                                            <input value="{{ workout_exercise.warmup.0 }}" type="text" class="w-full bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm">
                                        </div>

                                        <div>
                                            <label for="warmup-series-2-rep" class="block mb-2 text-sm font-medium text-gray-900">Seria rozgrzewkowa 2</label>
                                            <input value="{{ workout_exercise.warmup.1 }}" type="text" class="w-full bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm">
                                        </div>

                                        <div>
                                            <label for="warmup-series-3-rep" class="block mb-2 text-sm font-medium text-gray-900">Seria rozgrzewkowa 3</label>
                                            <input value="{{ workout_exercise.warmup.2 }}" type="text" class="w-full bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm">
                                        </div>


                                        <!-- Seria główna 1-4 -->
                                        <div>
                                            <label for="main-series-1-rep" class="block mb-2 text-sm font-medium text-gray-900">Seria główna 1</label>
                                            <input value="{{ workout_exercise.main.0 }}" type="text" class="w-full bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm">
                                        </div>

                                        <div>
                                            <label for="main-series-2-rep" class="block mb-2 text-sm font-medium text-gray-900">Seria główna 2</label>
                                            <input value="{{ workout_exercise.main.1 }}" type="text" class="w-full bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm">
                                        </div>

                                        <div>
                                            <label for="main-series-3-rep" class="block mb-2 text-sm font-medium text-gray-900">Seria główna 3</label>
                                            <input value="{{ workout_exercise.main.2 }}" type="text" class="w-full bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm">
                                        </div>

                                        <div>
                                            <label for="main-series-4-rep" class="block mb-2 text-sm font-medium text-gray-900">Seria główna 4</label>
                                            <input value="{{ workout_exercise.main.3 }}" type="text" class="w-full bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm">
                                        </div>

                                        <!-- Alternatywne ćwiczenie -->
                                        <div>
                                            <label for="exercise-id" class="block mb-2 text-sm font-medium text-gray-900">Ćwiczenie</label>
                                            <select class="w-full bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 transition duration-300 ease-in-out focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm focus:shadow">
                                                {% for exercise in exercises %}
                                                    <option {% if workout_exercise.alter_exercise == exercise %} selected {% endif %}{% if exercise == workout_exercise.exercise %} selected {% endif %} value="{{ exercise.id }}">{{ exercise.id }} {{ exercise.title }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        <div></div>
                                        <!-- Komentarz -->
                                        <div class="sm:col-span-2 col-span-1">
                                            <label for="comment" class="block mb-2 text-sm font-medium text-gray-900">Komentarz</label>
                                            <textarea class="w-full h-24 bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm">{{ workout_exercise.comment }}</textarea>
                                        </div>

                                        <!-- Przyciski góra/dół/usuń -->
                                        <div class="mx-10 flex flex-row justify-end w-full pr-8">
                                            <div class="mx-1 flex flex-row items-center">
                                                <button onclick="moveDown(this)" type="button" class="text-white bg-blue-700 hover:bg-blue-800 focus:outline-none font-medium rounded-lg text-sm px-2.5 py-2.5 text-center inline-flex items-center me-2 mb-2">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v13M5 12l7 7 7-7"/></svg>
                                                </button>
                                            </div>
                                            <div class="mx-1 flex flex-row items-center">
                                                <button onclick="moveUp(this)" type="button" class="text-white bg-blue-700 hover:bg-blue-800 focus:outline-none font-medium rounded-lg text-sm px-2.5 py-2.5 text-center inline-flex items-center me-2 mb-2">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 19V6M5 12l7-7 7 7"/></svg>
                                                </button>
                                            </div>
                                            <div class="mx-1 flex flex-row items-center">
                                                <button onclick="deleteRow(this)" type="button" class="text-white bg-red-600 hover:bg-red-800 focus:outline-none font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center me-2 mb-2">
                                                <svg class="my-auto" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#FFFFFF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                                                    <p class="ml-2">Usuń</p>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                `
                tableBody.appendChild(newRow{{ forloop.counter }});
            {% endfor %}
            updateFieldNames();
            updateRowNumbers();
            {% for workout_exercise in workout_exercises %}
                warmupSeriesUpdate({{ forloop.counter }});
                mainSeriesUpdate({{ forloop.counter }});
            {% endfor %}
            document.getElementById('rowCount').value = {{ workout_exercises | length }};
        }

        function addRow() {
            const tableBody = document.getElementById('exercise-list')
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
<div class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03] flex flex-col mb-4">
    <div class="px-5 py-4 sm:px-6 sm:py-5">
        <h3 class="exercise-hash-id text-base font-medium text-gray-800 dark:text-white/90"></h3>
    </div>

    <!-- Główna siatka inputów -->
    <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6 p-6">

        <!-- Ćwiczenie -->
        <div>
            <label for="exercise-id" class="block mb-2 text-sm font-medium text-gray-900">Ćwiczenie</label>
            <select class="w-full bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 transition duration-300 ease-in-out focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm focus:shadow">
                {% for exercise in exercises %}
                    <option value="{{ exercise.id }}">{{ exercise.id }} {{ exercise.title }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- Tempo -->
        <div>
            <label for="tempo" class="block mb-2 text-sm font-medium text-gray-900">Tempo</label>
            <input type="text" class="w-full bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 transition duration-300 ease-in-out focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm focus:shadow">
        </div>

        <!-- Odpoczynek -->
        <div class="flex flex-col">
            <label for="rest" class="block mb-2 text-sm font-medium text-gray-900">Odpoczynek</label>
            <div class="flex gap-4">
                <input type="number" class="w-16 bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm">
                <span class="flex items-center">:</span>
                <input type="number" class="w-16 bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm">
            </div>
        </div>

        <!-- Seria rozgrzewkowa -->
        <div>
            <label for="warmup-series" class="block mb-2 text-sm font-medium text-gray-900">Seria rozgrzewkowa</label>
            <input type="number" min="0" max="3" class="w-full bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm">
        </div>

        <!-- Seria główna -->
        <div>
            <label for="main-series" class="block mb-2 text-sm font-medium text-gray-900">Seria główna</label>
            <input type="number" min="0" max="4" class="w-full bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm">
        </div>

        <!-- Powtórzenia w serii głównej -->
        <div>
            <label for="main-series-reps" class="block mb-2 text-sm font-medium text-gray-900">Powtórzenia w serii głównej</label>
            <input type="text" class="w-full bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm">
        </div>

        <!-- Seria rozgrzewkowa 1, 2, 3 -->
        <div>
            <label for="warmup-series-1-rep" class="block mb-2 text-sm font-medium text-gray-900">Seria rozgrzewkowa 1</label>
            <input disabled type="text" class="w-full bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm">
        </div>

        <div>
            <label for="warmup-series-2-rep" class="block mb-2 text-sm font-medium text-gray-900">Seria rozgrzewkowa 2</label>
            <input disabled type="text" class="w-full bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm">
        </div>

        <div>
            <label for="warmup-series-3-rep" class="block mb-2 text-sm font-medium text-gray-900">Seria rozgrzewkowa 3</label>
            <input disabled type="text" class="w-full bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm">
        </div>


        <!-- Seria główna 1-4 -->
        <div>
            <label for="main-series-1-rep" class="block mb-2 text-sm font-medium text-gray-900">Seria główna 1</label>
            <input disabled type="text" class="w-full bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm">
        </div>

        <div>
            <label for="main-series-2-rep" class="block mb-2 text-sm font-medium text-gray-900">Seria główna 2</label>
            <input disabled type="text" class="w-full bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm">
        </div>

        <div>
            <label for="main-series-3-rep" class="block mb-2 text-sm font-medium text-gray-900">Seria główna 3</label>
            <input disabled type="text" class="w-full bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm">
        </div>

        <div>
            <label for="main-series-4-rep" class="block mb-2 text-sm font-medium text-gray-900">Seria główna 4</label>
            <input disabled type="text" class="w-full bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm">
        </div>

        <!-- Alternatywne ćwiczenie -->
        <div>
            <label for="alter-exercise-id" class="block mb-2 text-sm font-medium text-gray-900">Alternatywne ćwiczenie</label>
            <select class="w-full bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm">
                <option value="" selected></option>
                {% for exercise in exercises %}
                    <option value="{{ exercise.id }}">{{ exercise.id }} {{ exercise.title }}</option>
                {% endfor %}
            </select>
        </div>
        <div></div>
        <!-- Komentarz -->
        <div class="sm:col-span-2 col-span-1">
            <label for="comment" class="block mb-2 text-sm font-medium text-gray-900">Komentarz</label>
            <textarea class="w-full h-24 bg-transparent placeholder:text-slate-400 text-slate-700 text-sm border border-slate-200 rounded-md px-3 py-2 focus:outline-none focus:border-slate-400 hover:border-slate-300 shadow-sm"></textarea>
        </div>

        <!-- Przyciski góra/dół/usuń -->
        <div class="mx-10 flex flex-row justify-end w-full pr-8">
            <div class="mx-1 flex flex-row items-center">
                <button onclick="moveDown(this)" type="button" class="text-white bg-blue-700 hover:bg-blue-800 focus:outline-none font-medium rounded-lg text-sm px-2.5 py-2.5 text-center inline-flex items-center me-2 mb-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v13M5 12l7 7 7-7"/></svg>
                </button>
            </div>
            <div class="mx-1 flex flex-row items-center">
                <button onclick="moveUp(this)" type="button" class="text-white bg-blue-700 hover:bg-blue-800 focus:outline-none font-medium rounded-lg text-sm px-2.5 py-2.5 text-center inline-flex items-center me-2 mb-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 19V6M5 12l7-7 7 7"/></svg>
                </button>
            </div>
            <div class="mx-1 flex flex-row items-center">
                <button onclick="deleteRow(this)" type="button" class="text-white bg-red-600 hover:bg-red-800 focus:outline-none font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center me-2 mb-2">
                <svg class="my-auto" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#FFFFFF" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                    <p class="ml-2">Usuń</p>
                </button>
            </div>
        </div>
    </div>
</div>
            `
            tableBody.appendChild(newRow);
            updateRowNumbers();
            updateFieldNames();
        }

        function deleteRow(button) {
            const row = button.closest('tr');
            row.remove();
            updateRowNumbers();
            updateFieldNames();
        }

        function moveUp(button) {
            const row = button.closest('tr');
            const previousRow = row.previousElementSibling;
            if (previousRow) {
                row.parentNode.insertBefore(row, previousRow);
                updateRowNumbers();
            }
            updateFieldNames();
        }

        function moveDown(button) {
            const row = button.closest('tr');
            const nextRow = row.nextElementSibling;
            if (nextRow) {
                row.parentNode.insertBefore(nextRow, row);
                updateRowNumbers();
            }
            updateFieldNames();
        }
    </script>
{% endblock %}

{% block content %}
    <form class="grid grid-cols-1 gap-6 sm:grid-cols-2" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="space-y-6 col-span-1">
            <div class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]">
                <div class="px-5 py-4 sm:px-6 sm:py-5">
                    <h3 class="text-base font-medium text-gray-800 dark:text-white/90">Edycja treningu {% if training.is_personal %} personalnego {% endif %} {% if not training.is_personal %} ogólnego {% endif %}#{{ training.id }}</h3>
                </div>
                <div class="space-y-6 border-t border-gray-100 p-5 sm:p-6 dark:border-gray-800">
                    <!-- Elements -->
                    <div>
                        <label
                                class="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"
                        >
                            Nazwa treningu
                        </label>
                        <input name="title" id="title"
                               type="text"
                               class="dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full rounded-lg border border-gray-300 bg-transparent px-4 py-2.5 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                               value="{{ training.title }}"
                        />
                    </div>
                    <!-- Elements -->
                    <div class="flex flex-row justify-around mb-5 w-full">
                        <div class="flex items-center">
                            <input {% if training.is_personal %} checked {% endif %} id="personal-training-radio" type="radio" value="personal" name="training-type" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 focus:ring-2">
                            <label for="personal-training-radio" class="ms-2 text-sm font-medium text-gray-900">Trening personalny</label>
                        </div>
                        <div class="flex items-center">
                            <input {% if not training.is_personal %} checked {% endif %} id="general-training-radio" type="radio" value="general" name="training-type" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 focus:ring-2">
                            <label for="general-training-radio" class="ms-2 text-sm font-medium text-gray-900">Trening ogólny</label>
                        </div>
                    </div>
                    <!-- Elements -->
                    <div class="flex lg:flex-row flex-col">
                        <div class="flex-1 lg:mr-2 mr-0">
                          <label
                            class="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"
                          >
                            Osoba
                          </label>
                          <div
                            x-data="{ isOptionSelected: false }"
                            class="relative z-20 bg-transparent"
                          >
                            <select name="workout-person" id="workout-person"
                              class="dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pr-11 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                              :class="isOptionSelected && 'text-gray-800 dark:text-white/90'"
                              @change="isOptionSelected = true">
                                {% for client in clients %}
                                    <option class="text-gray-700 dark:bg-gray-900 dark:text-gray-400" value="{{ client.id }}" {% if client.id == training.clinet.id %} selected {% endif %}>{{ client.id }} {{ client.first_name }} {{ client.last_name }}</option>
                                {% endfor %}
                            </select>

                            <span
                              class="pointer-events-none absolute top-1/2 right-4 z-30 -translate-y-1/2 text-gray-500 dark:text-gray-400"
                            >
                              <svg
                                class="stroke-current"
                                width="20"
                                height="20"
                                viewBox="0 0 20 20"
                                fill="none"
                                xmlns="http://www.w3.org/2000/svg"
                              >
                                <path
                                  d="M4.79175 7.396L10.0001 12.6043L15.2084 7.396"
                                  stroke=""
                                  stroke-width="1.5"
                                  stroke-linecap="round"
                                  stroke-linejoin="round"
                                />
                              </svg>
                            </span>
                          </div>
                        </div>
                        <div class="flex-1 lg:ml-2 ml-0 lg:mt-0 mt-2">
                          <label
                            class="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"
                          >
                            Data treningu
                          </label>

                          <div class="relative">
                            <input
                                name="workout_date"
                                id="workout_date"
                              type="date"
                              placeholder="Select date"
                              class="dark:bg-dark-900 shadow-theme-xs focus:border-brand-300 focus:ring-brand-500/10 dark:focus:border-brand-800 h-11 w-full appearance-none rounded-lg border border-gray-300 bg-transparent bg-none px-4 py-2.5 pr-11 pl-4 text-sm text-gray-800 placeholder:text-gray-400 focus:ring-3 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-white/90 dark:placeholder:text-white/30"
                              onclick="this.showPicker()"
                                 value="{{ training.workout_date|date:'Y-m-d' }}"
                            />
                            <span
                              class="pointer-events-none absolute top-1/2 right-3 -translate-y-1/2 text-gray-500 dark:text-gray-400"
                            >
                              <svg
                                class="fill-current"
                                width="20"
                                height="20"
                                viewBox="0 0 20 20"
                                fill="none"
                                xmlns="http://www.w3.org/2000/svg"
                              >
                                <path
                                  fill-rule="evenodd"
                                  clip-rule="evenodd"
                                  d="M6.66659 1.5415C7.0808 1.5415 7.41658 1.87729 7.41658 2.2915V2.99984H12.5833V2.2915C12.5833 1.87729 12.919 1.5415 13.3333 1.5415C13.7475 1.5415 14.0833 1.87729 14.0833 2.2915V2.99984L15.4166 2.99984C16.5212 2.99984 17.4166 3.89527 17.4166 4.99984V7.49984V15.8332C17.4166 16.9377 16.5212 17.8332 15.4166 17.8332H4.58325C3.47868 17.8332 2.58325 16.9377 2.58325 15.8332V7.49984V4.99984C2.58325 3.89527 3.47868 2.99984 4.58325 2.99984L5.91659 2.99984V2.2915C5.91659 1.87729 6.25237 1.5415 6.66659 1.5415ZM6.66659 4.49984H4.58325C4.30711 4.49984 4.08325 4.7237 4.08325 4.99984V6.74984H15.9166V4.99984C15.9166 4.7237 15.6927 4.49984 15.4166 4.49984H13.3333H6.66659ZM15.9166 8.24984H4.08325V15.8332C4.08325 16.1093 4.30711 16.3332 4.58325 16.3332H15.4166C15.6927 16.3332 15.9166 16.1093 15.9166 15.8332V8.24984Z"
                                  fill=""
                                />
                              </svg>
                            </span>
                          </div>
                        </div>
                      </div>
                    <!-- Elements -->
                    <div class="flex flex-row justify-around mb-5 w-full">
                        <div class="flex items-center">
                            <input {% if training.visibility %} checked {% endif %} id="visible-yes-radio" type="radio" value="yes" name="visible-radio" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 focus:ring-2">
                            <label for="visible-yes-radio" class="ms-2 text-sm font-medium text-gray-900">Widoczny</label>
                        </div>
                        <div class="flex items-center">
                            <input {% if not training.visibility %} checked {% endif %} id="visible-no-radio" type="radio" value="no" name="visible-radio" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 focus:ring-2">
                            <label for="visible-no-radio" class="ms-2 text-sm font-medium text-gray-900">Niewidoczny</label>
                        </div>
                    </div>
                    <div class="flex justify-end">
                        <button onclick="submitForm(event)"
                                class="bg-blue-700 hover:bg-blue-900 inline-flex items-center px-10 py-2.5 mt-4 sm:mt-6 text-sm font-medium text-center text-white rounded-lg focus:ring-4 focus:ring-primary-200 hover:bg-primary-800">
                            Zatwierdź
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="space-y-6 col-span-1">
            <div class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]">
                <div class="px-5 py-4 sm:px-6 sm:py-5">
                    <h3
                            class="text-base font-medium text-gray-800 dark:text-white/90"
                    >
                        Zdjęcie treningu
                    </h3>
                </div>
                <div
                        class="space-y-6 border-t border-gray-100 p-5 sm:p-6 dark:border-gray-800"
                >
                    <!-- Elements -->
                    <div>
                        <label
                                class="mb-1.5 block text-sm font-medium text-gray-700 dark:text-gray-400"
                        >
                            Prześlij plik
                        </label>
                        <input name="image" id="image"
                               type="file"
                               class="focus:border-ring-brand-300 shadow-theme-xs focus:file:ring-brand-300 h-11 w-full overflow-hidden rounded-lg border border-gray-300 bg-transparent text-sm text-gray-500 transition-colors file:mr-5 file:border-collapse file:cursor-pointer file:rounded-l-lg file:border-0 file:border-r file:border-solid file:border-gray-200 file:bg-gray-50 file:py-3 file:pr-3 file:pl-3.5 file:text-sm file:text-gray-700 placeholder:text-gray-400 hover:file:bg-gray-100 focus:outline-hidden dark:border-gray-700 dark:bg-gray-900 dark:text-gray-400 dark:text-white/90 dark:file:border-gray-800 dark:file:bg-white/[0.03] dark:file:text-gray-400 dark:placeholder:text-gray-400"
                        />
                    </div>
                    <div class="mb-5">
                        {% if training.image %}
                            <img class="rounded-md aspect-w-1 aspect-h-1 pb-0" src="{{ training.image.url }}" alt="Zdjęcie ćwiczenia">
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        <div class="space-y-6 col-span-3">
            <div class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]">
                <div class="px-5 py-4 sm:px-6 sm:py-5">
                    <h3 class="text-base font-medium text-gray-800 dark:text-white/90">Ćwiczenia w treningu</h3>
                </div>
                <div class="space-y-6 border-t border-b border-gray-100 p-5 sm:p-6 dark:border-gray-800">
                    <table class="w-full">
                        <tbody id="exercise-list">
                        </tbody>
                    </table>
                </div>
                <div class="flex flex-row w-auto p-4">
                    <div class="flex mr-auto">
                        <button onclick="addRow()" type="button" id="add-exercise" class="bg-blue-500 hover:bg-blue-700 inline-flex items-center px-10 py-2.5 mt-4 sm:mt-6 text-sm font-medium text-center text-white rounded-lg focus:ring-4 focus:ring-primary-200 hover:bg-primary-800">
                            Dodaj ćwiczenie
                        </button>
                    </div>
                    <div class="flex justify-center">
                        <button type="submit" class="bg-blue-700 hover:bg-blue-900 inline-flex items-center px-10 py-2.5 mt-4 sm:mt-6 text-sm font-medium text-center text-white rounded-lg focus:ring-4 focus:ring-primary-200 hover:bg-primary-800">
                            Zatwierdź
                        </button>
                    </div>
                </div>
            </div>
        </div>
    <input type="hidden" id="rowCount" name="rowCount" value="1">
    </form>

    <script>
        function toggleFields() {
            const personalTrainingRadio = document.getElementById('personal-training-radio');
            const trainingDate = document.getElementById('training-date');
            const trainingPerson = document.getElementById('training-person');

            if (personalTrainingRadio && trainingDate && trainingPerson) {
                const isPersonalTraining = personalTrainingRadio.checked;
                trainingDate.disabled = !isPersonalTraining;
                trainingPerson.disabled = !isPersonalTraining;
            }
        }

        const personalRadio = document.getElementById('personal-training-radio');
        const generalRadio = document.getElementById('general-training-radio');
        if (personalRadio) personalRadio.addEventListener('change', toggleFields);
        if (generalRadio) generalRadio.addEventListener('change', toggleFields);
        window.onload = toggleFields;
        window.onload = initializeTable;
    </script>
{% endblock %}
